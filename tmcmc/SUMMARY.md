# M3モデル問題 - 診断サマリー

## 1行で答える質問

**Q: M3の図のデータ点は、M3から生成？それともM1から？**

**A: M3から生成されている（M1からではない）**

## 診断結果サマリー

### ✅ 確認済み
1. **M3のデータ生成元**: M3モデルから独立に生成
2. **時間正規化の定義**: 正しく実装されている
3. **データ生成プロセス**: 正しく動作している

### ⚠️ 発見された問題

1. **時間スケールの違い**
   - M1: 0.025 (2501ステップ)
   - M3: 0.075 (751ステップ)
   - **テストA結果**: 同じt_arrでもズレは変わらない → **主要因ではない**

2. **Species重みの差**
   - 標準尤度の比率 (max/min): 1.14
   - Species 3が27.5%を占める（最大だが支配的ではない）
   - **テストB結果**: 中程度の差 → **主要因ではない可能性が高い**

## 最終結論

### 主要因の可能性（確度順）

1. **M3モデルの構造ミスマッチ**（結合項/パラメータ不足）
   - M1はOKでM3だけNG
   - 時間スケールやspecies重みは主要因ではない
   - **最も可能性が高い**

2. **校正に使ったデータ点が一部speciesのみ支配**
   - φ3, φ4が特に外れる
   - 実際の図を確認して詳細分析が必要

3. **尤度設計の問題**（M3でのspecies間の重み付け）
   - テストBでは中程度の差
   - 改善の余地はあるが主要因ではない可能性

## 推奨される次のアクション

1. **実際の図を詳細に分析**
   - どのspeciesがどのように外れているか
   - 特にφ3, φ4の挙動

2. **M3モデル構造の確認**
   - 結合項が適切にモデル化されているか
   - パラメータ数が十分か

3. **Posterior predictive bandの可視化**
   - 論文と同じ評価方法で確認

## テスト結果詳細

### テストA: 同じt_arr上で比較
- M3 (M3's t_arr) RMSE: 0.00978241
- M3 (M1's t_arr) RMSE: 0.00947791
- **結論**: 時間軸以外が主因

### テストB: 尤度の重み正規化
- 標準尤度の比率 (max/min): 1.14
- Species 3の残差RMSE: 0.0057（他は0.0109程度）
- **結論**: species重みの問題は中程度
